# 数据库脚本使用指南

查课系统数据库未采用外键等约束条件，但是鉴于表之间依然存在关联性，拟采用基本导入数据库。

## 一、准备数据

### 1.教室目录表——根目录下的“classroom.xls”

格式参考根目录下现有的“classroom.xls”，带括号的教室只保留一个（1）即可。

### 2.选课信息——根目录下的“choise.xls”

选课人数及其相关信息，格式参考根目录下现有的“choise.xls”。要去掉标题栏，从第一列开始依次是“容量”、“选课人数”、“课程名称”、“教师姓名”、“课程性质”、“课程类别”、“学分”、“总学时”、“周学时”、“起止周”、“上课时间”、“上课地点”、“选课课号”、“校区要求”、“教学班组成”、“授课学院”、“学生学院”、“讲课学时”、“上机学时”、“实验学时”。

### 3.教室课表——”class_table“目录下的文件名形如“1-401.xls”的一堆文件

教室课表，形如现有class_table文件目录下的内容（貌似不需要导入三牌楼的数据？），不支持中文文件名，要批量改名参照[这里](https://jingyan.baidu.com/article/656db918a7e848e381249c0e.html)；将带括号的教室文件保留一个（1）并命名为教室号（不带括号的部分）。注意，所有教室文件名都必须保持”1-401.xls“这种格式(所有文件名都不带括号)。

## 二、导入数据

### 1.大致流程

* 先将上述文件准备好。
* 修改脚本中关于数据库的设置（用于连接本地数据库）。
* 把数据导入到本地计算机（就是你正在使用的这台）的数据库中（如果没有安装，推荐安装xampp）。
* 导入到本地数据库中以后使用mysqldump导出sql文件。
* 修改sql文件，重要，注意，并不是云数据库中的每个表都要修改，具体参考根目录下的“SQLExample.sql”文件，只需要更新如文件中的那几个数据库。
* 备份云数据库中的数据，就是导出sql文件并下载下来（可能有点大）。
* 上传并执行从本地计算机数据库中导出的sql文件到云数据库。
* 已完成数据更新。

### 2.详细步骤

* 打开xampp并启动apache和mysql，将本系统放在网站根目录下。
* 修改根目录中的“database.php”文件，改成本地计算机数据库的用户名和密码。
* 命令行登录数据库，创建一个名为“check_class”的数据库，并切换至此库。
* 在数据库中执行本系统根目录下的“SQLExample.sql”文件创建表结构。
* 访问“http://localhost/phpmyadmin/”，将“check_class”数据库中所有表中的数据清空等待录入新的数据。
* 将修改好的“classroom.xls”文件放在根目录下（替换原有的“classroom.xls”），并执行“http://localhost/classroom.php“录入教室信息。
* 将整理好的一堆教室课表文件都放置在根目录下（再次强调文件名格式要符合要求）。
* 将“cell_analyse.php”文件226和227行中学期和学年改成要导入文件所对应的学期和学年。
* 将“class_analyse.php”文件92和93行的学期和学年按照上一行的要求进行更改。
* 执行“http://localhost/execl_analyse.php”.
* 执行“http://localhost/choise_analyse.php”.

### 3.其它

* 在“CloudDatabaseBackup”目录下有2017年10月14日做的云数据库“check_class”库的完整备份，以备紧急情况使用。
* 脚本执行时间可能会比较长，建议将“php.ini”文件中的超时时间设置的大一些以保证数据的完整性。
* 执行过程中可能或出现warning等提示语，请放心使用，不会影响最终的结果。